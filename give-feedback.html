<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale-1.0" />
    <title>Give Feedback |KGR</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://unpkg.com/feather-icons"></script>
    <link rel="icon" id="favicon" href="Black_KGR.png" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  </head>
  <body>
    <div id="header-placeholder"></div>

    <main>
      <div class="feedback-container">
        <div class="feedback-info">
          <h1>Share Your Thoughts</h1>
          <p>
            Your feedback is invaluable to us. Whether you've found an error,
            have a suggestion, or just want to comment on our research, we'd
            love to hear from you.
          </p>
          <p>
            This form is sent directly to our research team in Rewari, Haryana.
            We review every submission carefully.
          </p>
        </div>

        <form
          class="feedback-form"
          action="https://api.web3forms.com/submit"
          method="POST"
        >
          <input
            type="hidden"
            name="access_key"
            value="2618094e-9e6d-4a69-99df-725403e190a1"
          />

          <div class="form-row">
            <div class="form-group">
              <label for="name">Your Name</label>
              <input type="text" id="name" name="name" readonly />
            </div>
            <div class="form-group">
              <label for="email">Your Email</label>
              <input type="email" id="email" name="email" readonly />
            </div>
          </div>

          <div class="form-group">
            <label for="feedback-type">Type of Feedback</label>
            <div class="custom-select-wrapper" id="custom-select">
              <div class="custom-select-trigger">
                <span>General Comment</span>
                <i data-feather="chevron-down"></i>
              </div>
              <div class="custom-options">
                <span class="custom-option" data-value="General Comment"
                  >General Comment</span
                >
                <span
                  class="custom-option"
                  data-value="Suggestion for Future Research"
                  >Suggestion for Future Research</span
                >
                <span
                  class="custom-option"
                  data-value="Bug Report or Correction"
                  >Bug Report or Correction</span
                >
              </div>
            </div>
            <select
              id="feedback-type"
              name="feedback_type"
              style="display: none"
            >
              <option>General Comment</option>
              <option>Suggestion for Future Research</option>
              <option>Bug Report or Correction</option>
            </select>
          </div>

          <div class="form-group">
            <label for="message">Your Message</label>
            <textarea id="message" name="message" rows="5" required></textarea>
          </div>

          <button type="submit" class="submit-btn">Send Feedback</button>
        </form>
      </div>
    </main>
    <div id="access-modal" class="hidden">
      <div class="access-modal-content">
        <button id="close-modal-btn" class="close-modal-btn">&times;</button>
        <i data-feather="lock"></i>
        <h2 id="modal-title">Access Restricted</h2>
        <p id="modal-message"></p>
        <a href="" id="modal-login-btn" class="submit-btn">Login to Continue</a>
      </div>
    </div>
    <div id="footer-placeholder"></div>

    <script src="app.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        try {
          // get logged in user
          const {
            data: { user },
            error,
          } = await supabaseClient.auth.getUser();
          if (error) {
            console.error("Auth error:", error.message);
            return;
          }

          if (user) {
            const nameInput = document.getElementById("name");
            const emailInput = document.getElementById("email");

            // Fallback priority: profiles.full_name → user_metadata.full_name → email prefix
            let fullName =
              user.user_metadata?.full_name || user.email.split("@")[0];

            nameInput.value = fullName;
            emailInput.value = user.email;

            // Make them readonly but keep style consistent
            nameInput.readOnly = true;
            emailInput.readOnly = true;
            nameInput.style.cursor = "default";
            emailInput.style.cursor = "default";
          }
        } catch (err) {
          console.error("Autofill error:", err);
        }
      });
    </script>
  </body>
</html>
